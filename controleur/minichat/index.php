<?php
//Controleur de site
//---------------------------------------------------------------//
	//Lancement et paramètrage de la page
	//---------------------------------------------------------------// 		
	//---------------------------------------------------------------//

	//Code php:
	//---------------------------------------------------------------//
		//Importations du modèle (modele) : 
		//---------------------------------------------------------------//
			include_once('modele/minichat/get_messages.php');
		//---------------------------------------------------------------//
		//Traitement sur les données (contrôleur):
		//---------------------------------------------------------------//
			//Variables:
			//---------------------------------------------------------------//
				$nbre_message_page = 10;
				$nbre_message = get_nbre_results();
				$nbre_page = cal_nbre_page($nbre_message, $nbre_message_page);
				$first_message = 0;
			//---------------------------------------------------------------//

			//Sécurisation de l'affichage:
			//---------------------------------------------------------------//
				//Gestion des ereurs de session:
				//---------------------------------------------------------------//
					if(!isset($_SESSION['page_minichat']))
					{
						$_SESSION['page_minichat'] = 1;
					}
					if(isset($_SESSION['page_minichat']))
					{
						$first_message = (($_SESSION['page_minichat']-1)*($nbre_message_page));
					}
				//---------------------------------------------------------------//

				//Demande des messages:
				//---------------------------------------------------------------//
					$messages = get_messages($first_message, $nbre_message_page);
				//---------------------------------------------------------------//

				//Sécurisation:
				//---------------------------------------------------------------//
					foreach ($messages as $cle => $message)
					{
						$messages[$cle]['pseudo'] = htmlspecialchars($message['pseudo']);
						$messages[$cle]['message'] = htmlspecialchars($message['message']);
					}
				//---------------------------------------------------------------//
			//---------------------------------------------------------------//
		//---------------------------------------------------------------//
		$_SESSION['post_section']='minichat';
		//Affichage de la page (vue):
		//---------------------------------------------------------------//
			include_once('vue/minichat/index.php');
		//---------------------------------------------------------------//
	//---------------------------------------------------------------//
//---------------------------------------------------------------//
